%%%%%%%%%%%%SIMULATION NEWTON MIN PARABOLIC MEMBRANE%%%%%%%%%%%%%%%%%%%%


%% Adaptive inexact resolution
deg polynome = 1

test_number = 128

number of grids J = 3

Gamma_lin = 1e-3;
Gamma_alg = 1e-3;

Nmax_gmres_calls = 100;
Nmax_newton_calls = 30;

maxit_gmres = 3;

adaptivity = 3;
adaptivity_newton = 3;

Hmax = 0.09

Dt = 1e-3;
Tmax = 300;

meshdata(J).ne = 20928
%%%% The number of Newton iter = 30 is replaced by 15. In this case Nmax_newton_calls = 15

number_newton_iter_time_adapt_inex_res = [  1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     2
     4
     4
     4
     4
     4
     3
     2
     2
     3
     3
     2
     2
     4
     2
     3
     2
     2
     2
     2
     2
     2
     2
     2
     2
     2
     2
     2
     2
     2
     2
     2
     2
     2
     1
     2
     2
     2
     4
     4
     4
     5
     5
     5
     5
     4
    15
    15
     5
     3
     4
     4
     3
     5
     3
     3
     3
     4
     5
     4
     4
     4
     4
     4
     2
     4
     4
     4
     1
     2
     1
     4
     1
     4
     1
     2
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1]



%%% 213 ---> 143 
%%% 133 ---> 93
adapt_inex_number_gmres_iter_time = [15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    54
    54
    51
    48
    51
    45
    36
    36
    42
    42
    30
    33
    42
    36
    39
    39
    33
    36
    36
    33
    33
    30
    33
    33
    36
    30
    36
    33
    36
    33
    33
    33
    30
    27
    36
    33
    36
    42
    39
    45
    42
    45
    51
    51
    54
    143
    93
    63
    51
    48
    48
    42
    48
    42
    39
    42
    42
    42
    39
    42
    39
    39
    36
    30
    36
    39
    39
    21
    30
    24
    36
    24
    36
    24
    30
    21
    21
    21
    21
    21
    21
    21
    21
    21
    21
    21
    21
    21
    21
    21
    18
    21
    21
    21
    21
    21
    21
    21
    21
    21
    18
    21
    21
    21
    21
    21
    21
    21
    21
    21
    18
    21
    18
    21
    21
    18
    21
    18
    21
    21
    18
    21
    18
    18
    18
    18
    21
    21
    18
    21
    18
    18
    21
    18
    21
    21
    21
    21
    21
    21
    21
    21
    21
    21
    21
    21
    21
    21
    21
    21
    21
    21
    21
    21
    21
    21
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    12
    12
    12
    12
    12
    12
    12
    12
    12
    12
    12
    12
    12
    12
    12
    12
    12
    12
    12]




cum_number_newton_iter_time_adapt_inex_res = [1
     2
     3
     4
     5
     6
     7
     8
     9
    10
    12
    16
    20
    24
    28
    32
    35
    37
    39
    42
    45
    47
    49
    53
    55
    58
    60
    62
    64
    66
    68
    70
    72
    74
    76
    78
    80
    82
    84
    86
    88
    90
    92
    94
    95
    97
    99
   101
   105
   109
   113
   118
   123
   128
   133
   137
   167
   197
   202
   205
   209
   213
   216
   221
   224
   227
   230
   234
   239
   243
   247
   251
   255
   259
   261
   265
   269
   273
   274
   276
   277
   281
   282
   286
   287
   289
   290
   291
   292
   293
   294
   295
   296
   297
   298
   299
   300
   301
   302
   303
   304
   305
   306
   307
   308
   309
   310
   311
   312
   313
   314
   315
   316
   317
   318
   319
   320
   321
   322
   323
   324
   325
   326
   327
   328
   329
   330
   331
   332
   333
   334
   335
   336
   337
   338
   339
   340
   341
   342
   343
   344
   345
   346
   347
   348
   349
   350
   351
   352
   353
   354
   355
   356
   357
   358
   359
   360
   361
   362
   363
   364
   365
   366
   367
   368
   369
   370
   371
   372
   373
   374
   375
   376
   377
   378
   379
   380
   381
   382
   383
   384
   385
   386
   387
   388
   389
   390
   391
   392
   393
   394
   395
   396
   397
   398
   399
   400
   401
   402
   403
   404
   405
   406
   407
   408
   409
   410
   411
   412
   413
   414
   415
   416
   417
   418
   419
   420
   421
   422
   423
   424
   425
   426
   427
   428
   429
   430
   431
   432
   433
   434
   435
   436
   437
   438
   439
   440
   441
   442
   443
   444
   445
   446
   447
   448
   449
   450
   451
   452
   453
   454
   455
   456
   457
   458
   459
   460
   461
   462
   463
   464
   465
   466
   467
   468
   469
   470
   471
   472
   473
   474
   475
   476
   477
   478
   479
   480
   481
   482
   483
   484
   485
   486
   487
   488
   489
   490
   491
   492
   493
   494
   495
   496
   497
   498
   499
   500
   501
   502
   503]
%%% cumsum modified when Nmax_newton_calls=15

cum_number_newton_iter_time_adapt_inex_res =

     1
     2
     3
     4
     5
     6
     7
     8
     9
    10
    12
    16
    20
    24
    28
    32
    35
    37
    39
    42
    45
    47
    49
    53
    55
    58
    60
    62
    64
    66
    68
    70
    72
    74
    76
    78
    80
    82
    84
    86
    88
    90
    92
    94
    95
    97
    99
   101
   105
   109
   113
   118
   123
   128
   133
   137
   152
   167
   172
   175
   179
   183
   186
   191
   194
   197
   200
   204
   209
   213
   217
   221
   225
   229
   231
   235
   239
   243
   244
   246
   247
   251
   252
   256
   257
   259
   260
   261
   262
   263
   264
   265
   266
   267
   268
   269
   270
   271
   272
   273
   274
   275
   276
   277
   278
   279
   280
   281
   282
   283
   284
   285
   286
   287
   288
   289
   290
   291
   292
   293
   294
   295
   296
   297
   298
   299
   300
   301
   302
   303
   304
   305
   306
   307
   308
   309
   310
   311
   312
   313
   314
   315
   316
   317
   318
   319
   320
   321
   322
   323
   324
   325
   326
   327
   328
   329
   330
   331
   332
   333
   334
   335
   336
   337
   338
   339
   340
   341
   342
   343
   344
   345
   346
   347
   348
   349
   350
   351
   352
   353
   354
   355
   356
   357
   358
   359
   360
   361
   362
   363
   364
   365
   366
   367
   368
   369
   370
   371
   372
   373
   374
   375
   376
   377
   378
   379
   380
   381
   382
   383
   384
   385
   386
   387
   388
   389
   390
   391
   392
   393
   394
   395
   396
   397
   398
   399
   400
   401
   402
   403
   404
   405
   406
   407
   408
   409
   410
   411
   412
   413
   414
   415
   416
   417
   418
   419
   420
   421
   422
   423
   424
   425
   426
   427
   428
   429
   430
   431
   432
   433
   434
   435
   436
   437
   438
   439
   440
   441
   442
   443
   444
   445
   446
   447
   448
   449
   450
   451
   452
   453
   454
   455
   456
   457
   458
   459
   460
   461
   462
   463
   464
   465
   466
   467
   468
   469
   470
   471
   472
   473

%%%  



cumsum for gmres modified when Nmax_newton_calls=15

cum_adapt_inex_number_gmres_iter_time = [15
          30
          45
          60
          75
          90
         105
         120
         135
         150
         165
         219
         273
         324
         372
         423
         468
         504
         540
         582
         624
         654
         687
         729
         765
         804
         843
         876
         912
         948
         981
        1014
        1044
        1077
        1110
        1146
        1176
        1212
        1245
        1281
        1314
        1347
        1380
        1410
        1437
        1473
        1506
        1542
        1584
        1623
        1668
        1710
        1755
        1806
        1857
        1911
        2054
        2147
        2210
        2261
        2309
        2357
        2399
        2447
        2489
        2528
        2570
        2612
        2654
        2693
        2735
        2774
        2813
        2849
        2879
        2915
        2954
        2993
        3014
        3044
        3068
        3104
        3128
        3164
        3188
        3218
        3239
        3260
        3281
        3302
        3323
        3344
        3365
        3386
        3407
        3428
        3449
        3470
        3491
        3512
        3533
        3551
        3572
        3593
        3614
        3635
        3656
        3677
        3698
        3719
        3740
        3758
        3779
        3800
        3821
        3842
        3863
        3884
        3905
        3926
        3947
        3965
        3986
        4004
        4025
        4046
        4064
        4085
        4103
        4124
        4145
        4163
        4184
        4202
        4220
        4238
        4256
        4277
        4298
        4316
        4337
        4355
        4373
        4394
        4412
        4433
        4454
        4475
        4496
        4517
        4538
        4559
        4580
        4601
        4622
        4643
        4664
        4685
        4706
        4727
        4748
        4769
        4790
        4811
        4832
        4853
        4874
        4892
        4910
        4928
        4946
        4964
        4982
        5000
        5018
        5036
        5054
        5072
        5090
        5108
        5126
        5144
        5162
        5180
        5198
        5216
        5234
        5252
        5270
        5288
        5306
        5324
        5342
        5360
        5378
        5396
        5414
        5432
        5450
        5468
        5486
        5504
        5522
        5540
        5558
        5576
        5594
        5612
        5630
        5648
        5666
        5684
        5702
        5720
        5738
        5756
        5771
        5786
        5801
        5816
        5831
        5846
        5861
        5876
        5891
        5906
        5921
        5936
        5951
        5966
        5981
        5996
        6011
        6026
        6041
        6056
        6071
        6086
        6101
        6116
        6131
        6146
        6161
        6176
        6191
        6206
        6221
        6236
        6251
        6266
        6281
        6296
        6311
        6326
        6341
        6356
        6371
        6386
        6401
        6416
        6431
        6446
        6461
        6476
        6491
        6506
        6521
        6536
        6551
        6566
        6581
        6596
        6611
        6626
        6641
        6656
        6671
        6686
        6701
        6716
        6731
        6743
        6755
        6767
        6779
        6791
        6803
        6815
        6827
        6839
        6851
        6863
        6875
        6887
        6899
        6911
        6923
        6935
        6947
        6959]


cum_number_gmres_iter_time_adapt_inex_res = [15
          30
          45
          60
          75
          90
         105
         120
         135
         150
         165
         219
         273
         324
         372
         423
         468
         504
         540
         582
         624
         654
         687
         729
         765
         804
         843
         876
         912
         948
         981
        1014
        1044
        1077
        1110
        1146
        1176
        1212
        1245
        1281
        1314
        1347
        1380
        1410
        1437
        1473
        1506
        1542
        1584
        1623
        1668
        1710
        1755
        1806
        1857
        1911
        2124
        2257
        2320
        2371
        2419
        2467
        2509
        2557
        2599
        2638
        2680
        2722
        2764
        2803
        2845
        2884
        2923
        2959
        2989
        3025
        3064
        3103
        3124
        3154
        3178
        3214
        3238
        3274
        3298
        3328
        3349
        3370
        3391
        3412
        3433
        3454
        3475
        3496
        3517
        3538
        3559
        3580
        3601
        3622
        3643
        3661
        3682
        3703
        3724
        3745
        3766
        3787
        3808
        3829
        3850
        3868
        3889
        3910
        3931
        3952
        3973
        3994
        4015
        4036
        4057
        4075
        4096
        4114
        4135
        4156
        4174
        4195
        4213
        4234
        4255
        4273
        4294
        4312
        4330
        4348
        4366
        4387
        4408
        4426
        4447
        4465
        4483
        4504
        4522
        4543
        4564
        4585
        4606
        4627
        4648
        4669
        4690
        4711
        4732
        4753
        4774
        4795
        4816
        4837
        4858
        4879
        4900
        4921
        4942
        4963
        4984
        5002
        5020
        5038
        5056
        5074
        5092
        5110
        5128
        5146
        5164
        5182
        5200
        5218
        5236
        5254
        5272
        5290
        5308
        5326
        5344
        5362
        5380
        5398
        5416
        5434
        5452
        5470
        5488
        5506
        5524
        5542
        5560
        5578
        5596
        5614
        5632
        5650
        5668
        5686
        5704
        5722
        5740
        5758
        5776
        5794
        5812
        5830
        5848
        5866
        5881
        5896
        5911
        5926
        5941
        5956
        5971
        5986
        6001
        6016
        6031
        6046
        6061
        6076
        6091
        6106
        6121
        6136
        6151
        6166
        6181
        6196
        6211
        6226
        6241
        6256
        6271
        6286
        6301
        6316
        6331
        6346
        6361
        6376
        6391
        6406
        6421
        6436
        6451
        6466
        6481
        6496
        6511
        6526
        6541
        6556
        6571
        6586
        6601
        6616
        6631
        6646
        6661
        6676
        6691
        6706
        6721
        6736
        6751
        6766
        6781
        6796
        6811
        6826
        6841
        6853
        6865
        6877
        6889
        6901
        6913
        6925
        6937
        6949
        6961
        6973
        6985
        6997
        7009
        7021
        7033
        7045
        7057
        7069]


%% file containing a matrix giving the number of gmres iterations per newton iterations per time step

'plot_simu_NM_adapt_inex_res_number_gmres_iter_newton_iter_time.mat'


%% Prepare plot for number of gmres iter per newton iter per time step
[rowIdx, colIdx] = find(simu_bis_adapt_inex_min_number_gmres_per_newon_per_time);
extract_term = accumarray(rowIdx,colIdx,[],@max); %% gives the number of Newton iterations per time step
time_step = Dt./ extract_term;
rep_time_adapt_inexact_newton = repelem(time_step, extract_term);

tp_number_gmres_iter_number_iter_time_adapt_inexact_res = simu_bis_adapt_inex_min_number_gmres_per_newon_per_time';

tp_number_gmres_iter_number_iter_time_adapt_inexact_res = reshape(tp_number_gmres_iter_number_iter_time_adapt_inexact_res, Tmax*size(simu_bis_adapt_inex_min_number_gmres_per_newon_per_time, 2),1);%% a matrix 

temp_non_zero = find(tp_number_gmres_iter_number_iter_time_adapt_inexact_res);

res_adapt_inexact_resolution = tp_number_gmres_iter_number_iter_time_adapt_inexact_res(temp_non_zero);


%% Plot number gmres iter per newton iter per time
figure;
plot(cumsum(rep_time_exact_newton), res_exact_resolution,...
'o -', 'linewidth', 2, 'Color', midnight_blue, 'MarkerFaceColor', midnight_blue);
hold on;
plot(cumsum(rep_time_adapt_inexact_newton), res_adapt_inexact_resolution,...
'^ -', 'linewidth', 2, 'Color', OrangeRed2, 'MarkerFaceColor', OrangeRed2);
xlabel('Time/Newton step', 'FontSize', 15);
ylabel('Number of GMRES iterations', 'FontSize', 15);
xt = get(gca, 'XTick');
set(gca, 'FontSize', 13);
h_legend = legend('exact Newton-min', 'adaptive inexact Newton-min');
set(h_legend, 'FontSize', 13);

















%%%%% Exact resolution
deg polynome = 1

test_number = 128

number of grids J = 3


Nmax_gmres_calls = 30;
Nmax_newton_calls = 30;

maxit_gmres = 3;

adaptivity = 1;
adaptivity_newton = 1;

Hmax = 0.09

Dt = 1e-3;
Tmax = 300;

meshdata(J).ne = 20928

number_newton_iter_time_exact_res = [1
     1
     1
     1
     1
     1
     1
     1
     2
     2
    30
     5
     4
     4
     4
     4
     4
     3
     4
     5
     4
     4
     3
     4
     3
     4
     3
     3
     4
     4
     4
     2
     4
     3
     4
     4
     3
     4
     4
     3
     2
     4
     3
     4
     4
     3
     4
     4
     5
     5
     5
     5
     6
     5
     6
     6
     7
     6
     7
     6
     5
     5
     4
     5
     5
     4
     4
     5
     5
     5
     5
     5
     5
     5
     4
     4
     6
     4
     4
     4
     5
     5
     5
     5
     5
     5
     5
     5
     4
     4
     4
     5
     5
     5
     4
     5
     5
     4
     4
     4
     4
     4
     5
     4
     5
     4
     4
     4
     5
     4
     5
     4
     3
     5
     4
     4
     4
     4
     4
     4
     4
     4
     5
     4
     4
     4
     4
     5
     3
     4
     3
     5
     4
     4
     4
     4
     4
     5
     3
     4
     3
     4
     4
     4
     4
     4
     4
     4
     4
     4
     4
     4
     4
     4
     4
     4
     4
     4
     4
     4
     4
     4
     4
     5
     4
     4
     4
     4
     4
     5
     4
     4
     4
     4
     4
     4
     4
     5
     4
     4
     4
     4
     4
     4
    30
     4
     4
     4
     4
     4
     4
     5
     4
     4
    30
    30
    30
    30
    30
    30
    30
    30
     4
     4
    30
    30
    30
    30
    30
    30
    30
     4
    30
    30
    30
    30
    30
    30
    30
    30
     4
    30
    30
    30
    30
    30
    30
     4
    30
    30
    30
     4
     4
    30
    30
    30
    30
    30
     4
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30
    30]


number_gmres_iter_time_exact_resolution = [30
          30
          30
          30
          30
          30
          30
          30
          30
          30
        2637
         135
         111
         105
         111
         111
         105
          81
          84
         108
          99
          78
          81
         102
          75
         102
          78
          72
          81
          84
          81
          81
          87
          84
          84
          84
          78
          84
          90
          87
          78
          87
          81
          75
          72
          78
          78
          84
         111
         105
         102
         105
         126
         126
         135
         150
         171
         177
         168
         123
         120
         117
         114
         126
         114
         105
         108
         108
         114
         108
         105
         111
         105
         102
          78
          96
         102
          93
          78
          75
          78
         102
          84
          99
          96
          93
          75
          78
          75
          78
          75
          93
          90
          75
          75
          93
          75
          75
          72
          72
          72
          72
          78
          72
          90
          72
          66
          72
          75
          75
          72
          75
          69
          75
          87
          72
          69
          72
          69
          72
          69
          66
          72
          66
          69
          63
          63
          66
          63
          48
          57
          66
          63
          47
          63
          47
          63
          63
          63
          63
          45
          60
          63
          47
          47
          47
          63
          48
          60
          48
          48
          48
          60
          48
          48
          48
          48
          60
          48
          48
          60
          63
          48
          60
          47
          48
          60
          48
          47
          57
          48
          47
          46
          46
          46
          47
          47
          60
          47
          47
          57
          47
          47
          60
          47
          47
          47
          47
          47
          47
          47
          60
          47
          57
          46
          47
          46
          46
          46
          46
          46
          46
          46
          46
          46
          45
          46
          45
          45
          46
          45
          54
          45
          45
          45
          45
          45
          43
          45
          45
          45
          43
          44
          45
          45
          44
          44
          45
          44
          43
          44
          45
          45
          43
          44
          43
          44
          43
          45
          46
          44
          44
          44
          44
          44
          44
          44
          43
          44
          44
          43
          43
          45
          43
          44
          43
          43
          46
          43
          43
          44
          43
          44
          42
          43
          43
          43
          43
          44
          43
          43
          44
          44
          44
          43
          43
          44
          43
          43
          42
          43
          44
          45
          42
          42
          42
          42
          43
          42
          42
          42
          42
          45
          42
          42
          42
          42
          42
          43
          42]



cum_number_newton_iter_time_exact_res =  [1
           2
           3
           4
           5
           6
           7
           8
          10
          12
          42
          47
          51
          55
          59
          63
          67
          70
          74
          79
          83
          87
          90
          94
          97
         101
         104
         107
         111
         115
         119
         121
         125
         128
         132
         136
         139
         143
         147
         150
         152
         156
         159
         163
         167
         170
         174
         178
         183
         188
         193
         198
         204
         209
         215
         221
         228
         234
         241
         247
         252
         257
         261
         266
         271
         275
         279
         284
         289
         294
         299
         304
         309
         314
         318
         322
         328
         332
         336
         340
         345
         350
         355
         360
         365
         370
         375
         380
         384
         388
         392
         397
         402
         407
         411
         416
         421
         425
         429
         433
         437
         441
         446
         450
         455
         459
         463
         467
         472
         476
         481
         485
         488
         493
         497
         501
         505
         509
         513
         517
         521
         525
         530
         534
         538
         542
         546
         551
         554
         558
         561
         566
         570
         574
         578
         582
         586
         591
         594
         598
         601
         605
         609
         613
         617
         621
         625
         629
         633
         637
         641
         645
         649
         653
         657
         661
         665
         669
         673
         677
         681
         685
         689
         694
         698
         702
         706
         710
         714
         719
         723
         727
         731
         735
         739
         743
         747
         752
         756
         760
         764
         768
         772
         776
         806
         810
         814
         818
         822
         826
         830
         835
         839
         843
         873
         903
         933
         963
         993
        1023
        1053
        1083
        1087
        1091
        1121
        1151
        1181
        1211
        1241
        1271
        1301
        1305
        1335
        1365
        1395
        1425
        1455
        1485
        1515
        1545
        1549
        1579
        1609
        1639
        1669
        1699
        1729
        1733
        1763
        1793
        1823
        1827
        1831
        1861
        1891
        1921
        1951
        1981
        1985
        2015
        2045
        2075
        2105
        2135
        2165
        2195
        2225
        2255
        2285
        2315
        2345
        2375
        2405
        2435
        2465
        2495
        2525
        2555
        2585
        2615
        2645
        2675
        2705
        2735
        2765
        2795
        2825
        2855
        2885
        2915
        2945
        2975
        3005
        3035
        3065
        3095
        3125
        3155
        3185
        3215
        3245
        3275
        3305
        3335
        3365
        3395
        3425
        3455
        3485
        3515
        3545
        3575
        3605
        3635
        3665
        3695
        3725
        3755
        3785
        3815]



cum_number_gmres_iter_time_exact_res = [30
          60
          90
         120
         150
         180
         210
         240
         270
         300
        2937
        3072
        3183
        3288
        3399
        3510
        3615
        3696
        3780
        3888
        3987
        4065
        4146
        4248
        4323
        4425
        4503
        4575
        4656
        4740
        4821
        4902
        4989
        5073
        5157
        5241
        5319
        5403
        5493
        5580
        5658
        5745
        5826
        5901
        5973
        6051
        6129
        6213
        6324
        6429
        6531
        6636
        6762
        6888
        7023
        7173
        7344
        7521
        7689
        7812
        7932
        8049
        8163
        8289
        8403
        8508
        8616
        8724
        8838
        8946
        9051
        9162
        9267
        9369
        9447
        9543
        9645
        9738
        9816
        9891
        9969
       10071
       10155
       10254
       10350
       10443
       10518
       10596
       10671
       10749
       10824
       10917
       11007
       11082
       11157
       11250
       11325
       11400
       11472
       11544
       11616
       11688
       11766
       11838
       11928
       12000
       12066
       12138
       12213
       12288
       12360
       12435
       12504
       12579
       12666
       12738
       12807
       12879
       12948
       13020
       13089
       13155
       13227
       13293
       13362
       13425
       13488
       13554
       13617
       13665
       13722
       13788
       13851
       13898
       13961
       14008
       14071
       14134
       14197
       14260
       14305
       14365
       14428
       14475
       14522
       14569
       14632
       14680
       14740
       14788
       14836
       14884
       14944
       14992
       15040
       15088
       15136
       15196
       15244
       15292
       15352
       15415
       15463
       15523
       15570
       15618
       15678
       15726
       15773
       15830
       15878
       15925
       15971
       16017
       16063
       16110
       16157
       16217
       16264
       16311
       16368
       16415
       16462
       16522
       16569
       16616
       16663
       16710
       16757
       16804
       16851
       16911
       16958
       17015
       17061
       17108
       17154
       17200
       17246
       17292
       17338
       17384
       17430
       17476
       17522
       17567
       17613
       17658
       17703
       17749
       17794
       17848
       17893
       17938
       17983
       18028
       18073
       18116
       18161
       18206
       18251
       18294
       18338
       18383
       18428
       18472
       18516
       18561
       18605
       18648
       18692
       18737
       18782
       18825
       18869
       18912
       18956
       18999
       19044
       19090
       19134
       19178
       19222
       19266
       19310
       19354
       19398
       19441
       19485
       19529
       19572
       19615
       19660
       19703
       19747
       19790
       19833
       19879
       19922
       19965
       20009
       20052
       20096
       20138
       20181
       20224
       20267
       20310
       20354
       20397
       20440
       20484
       20528
       20572
       20615
       20658
       20702
       20745
       20788
       20830
       20873
       20917
       20962
       21004
       21046
       21088
       21130
       21173
       21215
       21257
       21299
       21341
       21386
       21428
       21470
       21512
       21554
       21596
       21639
       21681]




%% file containing a matrix giving the number of gmres iterations per newton iterations per time step

'plot_simu_NM_exac_res_number_gmres_iter_newton_iter_time.mat'


%% Prepare plot for number of gmres iter per newton iter per time step
[rowIdx, colIdx] = find(simu_NM_exac_res_bis_number_gmres_iter_newton_iter_time);
extract_term = accumarray(rowIdx,colIdx,[],@max); %% gives the number of Newton iterations per time step
time_step = Dt./ extract_term;
rep_time_exact_newton = repelem(time_step, extract_term);

tp_number_gmres_iter_number_iter_time_exact_res = simu_NM_exac_res_bis_number_gmres_iter_newton_iter_time';

tp_number_gmres_iter_number_iter_time_exact_res = reshape(tp_number_gmres_iter_number_iter_time_exact_res, Tmax*size(simu_NM_exac_res_bis_number_gmres_iter_newton_iter_time, 2),1);%% a matrix 

temp_non_zero = find(tp_number_gmres_iter_number_iter_time_exact_res);

res_exact_resolution = tp_number_gmres_iter_number_iter_time_exact_res(temp_non_zero);


%% Plot number gmres iter per newton iter per time
figure;
plot(cumsum(rep_time_exact_newton), res_exact_resolution,...
'o -', 'linewidth', 2, 'Color', midnight_blue, 'MarkerFaceColor', midnight_blue);
xlabel('Time/Newton step', 'FontSize', 15);
ylabel('Number of GMRES iterations', 'FontSize', 15);
xt = get(gca, 'XTick');
set(gca, 'FontSize', 13);
h_legend = legend('exact Newton');
set(h_legend, 'FontSize', 13);





%%%%% Exact resolution
deg polynome = 1

test_number = 128

number of grids J = 3


Nmax_gmres_calls = 25;
Nmax_newton_calls = 20;

maxit_gmres = 3;

adaptivity = 1;
adaptivity_newton = 1;

Hmax = 0.09

Dt = 1e-3;
Tmax = 300;

meshdata(J).ne = 20928


number_newton_iter_time_exact_res = [1
     1
     1
     1
     1
     1
     1
     1
     2
     2
    20
     5
     4
     4
     4
     4
     4
     3
     4
     5
     4
     4
     3
     4
     3
     4
     3
     3
     4
     4
     4
     2
     4
     3
     4
     4
     3
     4
     4
     3
     2
     4
     3
     4
     4
     3
     4
     4
     5
     5
     5
     5
     6
     5
     6
     6
     7
     6
     7
     6
     5
     5
     4
     5
     5
     4
     4
     5
     5
     5
     5
     5
     5
     5
     4
     4
     6
     4
     4
     4
     5
     5
     5
     5
     5
     5
     5
     5
     4
     4
     4
     5
     5
     5
     4
     5
     5
     4
     4
     4
     4
     4
     5
     4
     5
     4
     4
     4
     5
     4
     5
     4
     3
     5
     4
     4
     4
     4
     4
     4
     4
     4
     5
     4
     4
     4
     4
     5
     3
     4
     3
     5
     4
     4
     4
     4
     4
     5
     3
     4
     3
     4
     4
     4
     4
     4
     4
     4
     4
     4
     4
     4
     4
     4
     4
     4
     4
     4
     5
     4
     4
     4
     4
     5
     4
     4
     4
     4
     4
     5
     4
     4
     4
     4
     4
     4
     4
     5
     4
     4
     4
     4
     4
     4
     4
     4
     4
     4
     4
     4
     4
     5
    20
     4
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
     4
    20
    20
     4
    20
    20
    20
     4
    20
    20
    20
    20
    20
    20
    20
    20
    20
     4
    20
    20
    20
    20
    20
    20
     4
     4
    20
     4
    20
    20
    20
    20
    20
    20
    20
    20
     5
     5
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20
    20]


number_gmres_iter_time_exact_res =  [30
          30
          30
          30
          30
          30
          30
          30
          30
          30
        1452
         135
         111
         105
         111
         111
         105
          81
          84
         108
          99
          78
          81
         102
          75
         102
          78
          72
          81
          84
          81
          81
          87
          84
          84
          84
          78
          84
          90
          87
          78
          87
          81
          75
          72
          78
          78
          84
         111
         105
         102
         105
         126
         126
         135
         150
         171
         177
         168
         123
         120
         117
         114
         126
         114
         105
         108
         108
         114
         108
         105
         111
         105
         102
          78
          96
         102
          93
          78
          75
          78
         102
          84
          99
          96
          93
          75
          78
          75
          78
          75
          93
          90
          75
          75
          93
          75
          75
          72
          72
          72
          72
          78
          72
          90
          72
          66
          72
          75
          75
          72
          75
          69
          75
          87
          72
          69
          72
          69
          72
          69
          66
          72
          66
          69
          63
          63
          66
          63
          48
          57
          66
          63
          47
          63
          47
          63
          63
          63
          63
          45
          60
          63
          47
          47
          48
          63
          47
          60
          48
          48
          48
          60
          48
          48
          48
          48
          60
          47
          48
          60
          63
          48
          60
          47
          48
          60
          47
          47
          57
          47
          46
          47
          47
          47
          47
          47
          60
          47
          47
          57
          47
          47
          60
          47
          48
          47
          47
          47
          47
          47
          60
          93
          57
          94
          94
          94
          94
          94
          94
          94
          94
          94
          94
          46
          94
          95
          46
          94
          96
          96
          54
          96
          94
          93
          93
          93
          92
          93
          92
          92
          45
          91
          92
          92
          92
          92
          93
          45
          45
          92
          45
          91
          92
          93
          92
          92
          92
          90
          91
          45
          45
          90
          91
          92
          92
          91
          92
          91
          91
          91
          91
          91
          91
          91
          91
          91
          92
          91
          91
          91
          91
          91
          91
          91
          92
          89
          91
          89
          89
          91
          91
          91
          93
          93
          92
          91
          91
          91
          93
          93
          92
          91
          93
          93
          93
          91
          91
          93
          91
          93
          91
          93
          93
          93
          93
          93
          90
          93
          92]



cum_number_newton_iter_time_exact_res =  [1
           2
           3
           4
           5
           6
           7
           8
          10
          12
          32
          37
          41
          45
          49
          53
          57
          60
          64
          69
          73
          77
          80
          84
          87
          91
          94
          97
         101
         105
         109
         111
         115
         118
         122
         126
         129
         133
         137
         140
         142
         146
         149
         153
         157
         160
         164
         168
         173
         178
         183
         188
         194
         199
         205
         211
         218
         224
         231
         237
         242
         247
         251
         256
         261
         265
         269
         274
         279
         284
         289
         294
         299
         304
         308
         312
         318
         322
         326
         330
         335
         340
         345
         350
         355
         360
         365
         370
         374
         378
         382
         387
         392
         397
         401
         406
         411
         415
         419
         423
         427
         431
         436
         440
         445
         449
         453
         457
         462
         466
         471
         475
         478
         483
         487
         491
         495
         499
         503
         507
         511
         515
         520
         524
         528
         532
         536
         541
         544
         548
         551
         556
         560
         564
         568
         572
         576
         581
         584
         588
         591
         595
         599
         603
         607
         611
         615
         619
         623
         627
         631
         635
         639
         643
         647
         651
         655
         659
         664
         668
         672
         676
         680
         685
         689
         693
         697
         701
         705
         710
         714
         718
         722
         726
         730
         734
         738
         743
         747
         751
         755
         759
         763
         767
         771
         775
         779
         783
         787
         791
         795
         800
         820
         824
         844
         864
         884
         904
         924
         944
         964
         984
        1004
        1024
        1028
        1048
        1068
        1072
        1092
        1112
        1132
        1136
        1156
        1176
        1196
        1216
        1236
        1256
        1276
        1296
        1316
        1320
        1340
        1360
        1380
        1400
        1420
        1440
        1444
        1448
        1468
        1472
        1492
        1512
        1532
        1552
        1572
        1592
        1612
        1632
        1637
        1642
        1662
        1682
        1702
        1722
        1742
        1762
        1782
        1802
        1822
        1842
        1862
        1882
        1902
        1922
        1942
        1962
        1982
        2002
        2022
        2042
        2062
        2082
        2102
        2122
        2142
        2162
        2182
        2202
        2222
        2242
        2262
        2282
        2302
        2322
        2342
        2362
        2382
        2402
        2422
        2442
        2462
        2482
        2502
        2522
        2542
        2562
        2582
        2602
        2622
        2642
        2662
        2682
        2702
        2722
        2742
        2762
        2782
        2802]




cum_number_gmres_iter_time_exact_res =  [30
          60
          90
         120
         150
         180
         210
         240
         270
         300
        1752
        1887
        1998
        2103
        2214
        2325
        2430
        2511
        2595
        2703
        2802
        2880
        2961
        3063
        3138
        3240
        3318
        3390
        3471
        3555
        3636
        3717
        3804
        3888
        3972
        4056
        4134
        4218
        4308
        4395
        4473
        4560
        4641
        4716
        4788
        4866
        4944
        5028
        5139
        5244
        5346
        5451
        5577
        5703
        5838
        5988
        6159
        6336
        6504
        6627
        6747
        6864
        6978
        7104
        7218
        7323
        7431
        7539
        7653
        7761
        7866
        7977
        8082
        8184
        8262
        8358
        8460
        8553
        8631
        8706
        8784
        8886
        8970
        9069
        9165
        9258
        9333
        9411
        9486
        9564
        9639
        9732
        9822
        9897
        9972
       10065
       10140
       10215
       10287
       10359
       10431
       10503
       10581
       10653
       10743
       10815
       10881
       10953
       11028
       11103
       11175
       11250
       11319
       11394
       11481
       11553
       11622
       11694
       11763
       11835
       11904
       11970
       12042
       12108
       12177
       12240
       12303
       12369
       12432
       12480
       12537
       12603
       12666
       12713
       12776
       12823
       12886
       12949
       13012
       13075
       13120
       13180
       13243
       13290
       13337
       13385
       13448
       13495
       13555
       13603
       13651
       13699
       13759
       13807
       13855
       13903
       13951
       14011
       14058
       14106
       14166
       14229
       14277
       14337
       14384
       14432
       14492
       14539
       14586
       14643
       14690
       14736
       14783
       14830
       14877
       14924
       14971
       15031
       15078
       15125
       15182
       15229
       15276
       15336
       15383
       15431
       15478
       15525
       15572
       15619
       15666
       15726
       15819
       15876
       15970
       16064
       16158
       16252
       16346
       16440
       16534
       16628
       16722
       16816
       16862
       16956
       17051
       17097
       17191
       17287
       17383
       17437
       17533
       17627
       17720
       17813
       17906
       17998
       18091
       18183
       18275
       18320
       18411
       18503
       18595
       18687
       18779
       18872
       18917
       18962
       19054
       19099
       19190
       19282
       19375
       19467
       19559
       19651
       19741
       19832
       19877
       19922
       20012
       20103
       20195
       20287
       20378
       20470
       20561
       20652
       20743
       20834
       20925
       21016
       21107
       21198
       21289
       21381
       21472
       21563
       21654
       21745
       21836
       21927
       22018
       22110
       22199
       22290
       22379
       22468
       22559
       22650
       22741
       22834
       22927
       23019
       23110
       23201
       23292
       23385
       23478
       23570
       23661
       23754
       23847
       23940
       24031
       24122
       24215
       24306
       24399
       24490
       24583
       24676
       24769
       24862
       24955
       25045
       25138
       25230]


