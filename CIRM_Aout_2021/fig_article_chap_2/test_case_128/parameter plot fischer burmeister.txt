%%% ADADPTIVE INEXACT RESOLUTION FISCHER BURMEISTER

deg polynomial = 1

test number = 128

tol_newton_exacte = 1e-10;
tol_gmres_exacte = 1e-11;

Gamma_lin = 1e-3;
Gamma_alg = 1e-3;

J = 3;

Nmax_gmres_calls = 50;
Nmax_newton_calls = 30;

maxit_gmres = 3;


adaptivity = 3;
adaptivity_newton = 3;




number_newton_iter_time_adapt_inex_res =   [1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     5
     9
     8
     8
     8
     8
     8
     5
     6
     6
     8
     5
     5
     7
     5
     8
     5
     5
     5
     5
     5
     5
     5
     5
     5
     5
     5
     5
     5
     5
     5
     5
     5
     5
     1
     5
     5
     5
     8
     6
     5
     9
     8
    10
     9
     8
    11
     9
     8
     9
     7
     8
     7
     8
     7
     6
     7
     8
     8
     8
     7
     8
     8
     7
     5
     7
     7
     7
     1
     7
     1
     7
     1
     7
     1
     7
     1
     7
     1
     4
     1
     4
     1
     1
     7
     1
     1
     4
     1
     1
     4
     1
     1
     3
     1
     1
     3
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1
     1]



number_gmres_iter_time =

    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    36
    90
    75
    72
    66
    75
    63
    51
    51
    54
    63
    42
    45
    54
    48
    51
    51
    39
    48
    45
    42
    42
    42
    42
    39
    45
    39
    48
    42
    42
    42
    45
    42
    39
    30
    45
    42
    45
    54
    45
    48
    54
    57
    72
    72
    75
    87
    93
    87
    78
    63
    66
    60
    60
    60
    51
    57
    57
    57
    51
    48
    51
    51
    45
    39
    45
    51
    51
    21
    51
    24
    54
    24
    51
    24
    51
    21
    51
    24
    36
    21
    36
    21
    24
    48
    21
    24
    39
    21
    24
    39
    21
    24
    33
    21
    21
    33
    21
    21
    24
    21
    21
    21
    21
    21
    21
    21
    21
    21
    21
    21
    21
    21
    21
    18
    18
    21
    21
    21
    21
    21
    21
    21
    18
    21
    21
    21
    18
    21
    18
    21
    21
    21
    21
    18
    21
    21
    21
    21
    21
    18
    21
    21
    21
    21
    21
    21
    21
    21
    21
    21
    21
    21
    21
    21
    21
    21
    21
    18
    18
    18
    18
    18
    21
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    18
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    15
    12
    12
    12
    12
    12
    12
    12
    12
    12
    12
    12
    12
    12
    12
    12
    12
    12
    12
    12


cum_number_newton_iter_time =

     1
     2
     3
     4
     5
     6
     7
     8
     9
    10
    15
    24
    32
    40
    48
    56
    64
    69
    75
    81
    89
    94
    99
   106
   111
   119
   124
   129
   134
   139
   144
   149
   154
   159
   164
   169
   174
   179
   184
   189
   194
   199
   204
   209
   210
   215
   220
   225
   233
   239
   244
   253
   261
   271
   280
   288
   299
   308
   316
   325
   332
   340
   347
   355
   362
   368
   375
   383
   391
   399
   406
   414
   422
   429
   434
   441
   448
   455
   456
   463
   464
   471
   472
   479
   480
   487
   488
   495
   496
   500
   501
   505
   506
   507
   514
   515
   516
   520
   521
   522
   526
   527
   528
   531
   532
   533
   536
   537
   538
   539
   540
   541
   542
   543
   544
   545
   546
   547
   548
   549
   550
   551
   552
   553
   554
   555
   556
   557
   558
   559
   560
   561
   562
   563
   564
   565
   566
   567
   568
   569
   570
   571
   572
   573
   574
   575
   576
   577
   578
   579
   580
   581
   582
   583
   584
   585
   586
   587
   588
   589
   590
   591
   592
   593
   594
   595
   596
   597
   598
   599
   600
   601
   602
   603
   604
   605
   606
   607
   608
   609
   610
   611
   612
   613
   614
   615
   616
   617
   618
   619
   620
   621
   622
   623
   624
   625
   626
   627
   628
   629
   630
   631
   632
   633
   634
   635
   636
   637
   638
   639
   640
   641
   642
   643
   644
   645
   646
   647
   648
   649
   650
   651
   652
   653
   654
   655
   656
   657
   658
   659
   660
   661
   662
   663
   664
   665
   666
   667
   668
   669
   670
   671
   672
   673
   674
   675
   676
   677
   678
   679
   680
   681
   682
   683
   684
   685
   686
   687
   688
   689
   690
   691
   692
   693
   694
   695
   696
   697
   698
   699
   700
   701
   702
   703
   704
   705
   706
   707
   708
   709
   710
   711
   712
   713
   714
   715
   716
   717
   718
   719
   720
   721
   722
   723
   724
   725
   726
   727
   728
   729


cum_number_gmres_iter_time_adapt_inex_res =  [15
          30
          45
          60
          75
          90
         105
         120
         135
         150
         186
         276
         351
         423
         489
         564
         627
         678
         729
         783
         846
         888
         933
         987
        1035
        1086
        1137
        1176
        1224
        1269
        1311
        1353
        1395
        1437
        1476
        1521
        1560
        1608
        1650
        1692
        1734
        1779
        1821
        1860
        1890
        1935
        1977
        2022
        2076
        2121
        2169
        2223
        2280
        2352
        2424
        2499
        2586
        2679
        2766
        2844
        2907
        2973
        3033
        3093
        3153
        3204
        3261
        3318
        3375
        3426
        3474
        3525
        3576
        3621
        3660
        3705
        3756
        3807
        3828
        3879
        3903
        3957
        3981
        4032
        4056
        4107
        4128
        4179
        4203
        4239
        4260
        4296
        4317
        4341
        4389
        4410
        4434
        4473
        4494
        4518
        4557
        4578
        4602
        4635
        4656
        4677
        4710
        4731
        4752
        4776
        4797
        4818
        4839
        4860
        4881
        4902
        4923
        4944
        4965
        4986
        5007
        5028
        5049
        5070
        5088
        5106
        5127
        5148
        5169
        5190
        5211
        5232
        5253
        5271
        5292
        5313
        5334
        5352
        5373
        5391
        5412
        5433
        5454
        5475
        5493
        5514
        5535
        5556
        5577
        5598
        5616
        5637
        5658
        5679
        5700
        5721
        5742
        5763
        5784
        5805
        5826
        5847
        5868
        5889
        5910
        5931
        5952
        5973
        5991
        6009
        6027
        6045
        6063
        6084
        6102
        6120
        6138
        6156
        6174
        6192
        6210
        6228
        6246
        6264
        6282
        6300
        6318
        6336
        6354
        6372
        6390
        6408
        6426
        6444
        6462
        6480
        6498
        6516
        6534
        6552
        6570
        6588
        6606
        6624
        6642
        6660
        6678
        6696
        6714
        6732
        6750
        6768
        6786
        6804
        6822
        6840
        6855
        6870
        6885
        6900
        6915
        6930
        6945
        6960
        6975
        6990
        7005
        7020
        7035
        7050
        7065
        7080
        7095
        7110
        7125
        7140
        7155
        7170
        7185
        7200
        7215
        7230
        7245
        7260
        7275
        7290
        7305
        7320
        7335
        7350
        7365
        7380
        7395
        7410
        7425
        7440
        7455
        7470
        7485
        7500
        7515
        7530
        7545
        7560
        7575
        7590
        7605
        7620
        7635
        7650
        7665
        7680
        7695
        7710
        7725
        7740
        7755
        7770
        7785
        7800
        7815
        7827
        7839
        7851
        7863
        7875
        7887
        7899
        7911
        7923
        7935
        7947
        7959
        7971
        7983
        7995
        8007
        8019
        8031
        8043]

%%% EXACT RESOLUTION FISCHER BURMEISTER

deg polynomial = 1

test number = 128

tol_newton_exacte = 1e-10;
tol_gmres_exacte = 1e-11;

J = 3;

Nmax_gmres_calls = 25;
Nmax_newton_calls = 20;

maxit_gmres = 3;


adaptivity = 1;
adaptivity_newton = 1;



number_newton_iter_time_FB_exact_res =  [1
     1
     1
     1
     1
     1
     1
     1
     2
     2
    20
    11
    10
    11
    11
    11
    10
     8
     9
    11
    10
     8
     8
    10
     9
    11
     9
     8
     8
     7
     9
     9
     8
     8
     9
     9
     8
     8
     9
     9
     9
     9
     9
     9
     7
     8
     8
     8
    11
    10
    11
    10
    10
    12
    12
    12
    12
    11
    12
    11
    12
    12
    12
    11
    11
    11
    11
    11
    11
    11
    11
    10
    11
    11
     9
    10
    10
    10
     9
     8
     8
    10
     9
    11
    10
    11
     8
     8
     8
     8
     8
    10
    10
     8
     8
    10
     8
     8
     8
     8
     8
     8
     9
     8
    10
     9
     8
     8
     9
     8
     8
     8
     8
     8
     9
     9
     8
     8
     9
     8
     8
     8
     8
     8
     9
     7
     8
     8
     8
     4
     7
     8
     8
     4
     8
     4
     9
     7
     8
     8
     3
     8
     9
     4
     4
     4
     8
     5
     8
     5
     4
     5
     8
     5
     5
     5
     6
     8
     6
     6
     8
     8
     7
     8
     8
     8
     9
     7
     7
     8
     7
     7
     7
     9
     7
     9
     9
     8
     9
     9
     8
     8
     8
     9
     8
    10
    10
    10
    10
     9
     9
     9
     9
     8
     9
     9
     9
     9
     9
     9
     9
     9
     9
     8
    10
     9
     9
     9
    10
     9
     9
     8
     9
     9
    10
    11
    11
    11
    10
    10
    10
    10
    10
    10
     9
    10
    10
    10
    10
    10
    10
    10
    10
    10
    10
    10
    12
    10
    12
    12
    12
    11
    11
    11
    11
    11
    11
    11
    11
    11
    11
    11
    11
    11
    11
    11
    11
    11
    11
    11
    11
    11
    11
    11
    11
    11
    11
    12
    12
    11
    12
    12
    12
    12
    12
    12
    12
    12
    11
    12
    11
    12
    11
    10
    11
    11
    11
    11
    11
    11
    11
    10
    11
    11
    11
    11
    11
    11
    11
    11]



number_gmres_iter_time_FB_exact_res = [30
          30
          30
          30
          30
          30
          30
          30
          30
          30
        1278
         258
         204
         204
         216
         216
         198
         177
         180
         210
         198
         159
         171
         198
         162
         183
         168
         147
         171
         165
         177
         174
         171
         171
         168
         171
         147
         165
         180
         171
         168
         174
         165
         150
         114
         156
         156
         162
         189
         180
         192
         189
         201
         237
         246
         261
         288
         282
         270
         249
         234
         225
         228
         216
         213
         201
         207
         198
         204
         195
         189
         195
         186
         189
         162
         177
         177
         168
         156
         144
         144
         165
         159
         180
         171
         165
         141
         141
         144
         144
         141
         162
         150
         132
         141
         150
         138
         135
         129
         141
         129
         132
         135
         132
         141
         132
         111
         126
         120
         132
         120
         129
         117
         126
         129
         132
         126
         126
         117
         126
         111
         108
         117
         111
         120
         102
         108
         108
         108
          48
          90
         105
         105
          48
         108
          47
          99
          93
         108
         105
          45
          96
          99
          48
          48
          48
         105
          48
          90
          48
          47
          48
          90
          48
          48
          48
          49
          90
          49
          49
          90
          96
          49
          84
          50
          50
          90
          49
          49
          78
          49
          49
          49
          50
          49
          50
          50
          84
          50
          50
          81
          50
          50
          90
          50
          51
          51
          51
          51
          50
          50
          87
          50
          78
          50
          50
          50
          50
          50
          50
          50
          50
          49
          49
          50
          49
          49
          49
          50
          49
          49
          75
          49
          49
          49
          50
          50
          50
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          50
          49
          50
          50
          50
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          49
          48
          49
          48
          49
          48
          47
          48
          48
          48
          48
          48
          48
          48
          47
          48
          48
          48
          48
          48
          48
          48
          48]




cum_number_newton_iter_time_FB_exact_res =     [1
           2
           3
           4
           5
           6
           7
           8
          10
          12
          32
          43
          53
          64
          75
          86
          96
         104
         113
         124
         134
         142
         150
         160
         169
         180
         189
         197
         205
         212
         221
         230
         238
         246
         255
         264
         272
         280
         289
         298
         307
         316
         325
         334
         341
         349
         357
         365
         376
         386
         397
         407
         417
         429
         441
         453
         465
         476
         488
         499
         511
         523
         535
         546
         557
         568
         579
         590
         601
         612
         623
         633
         644
         655
         664
         674
         684
         694
         703
         711
         719
         729
         738
         749
         759
         770
         778
         786
         794
         802
         810
         820
         830
         838
         846
         856
         864
         872
         880
         888
         896
         904
         913
         921
         931
         940
         948
         956
         965
         973
         981
         989
         997
        1005
        1014
        1023
        1031
        1039
        1048
        1056
        1064
        1072
        1080
        1088
        1097
        1104
        1112
        1120
        1128
        1132
        1139
        1147
        1155
        1159
        1167
        1171
        1180
        1187
        1195
        1203
        1206
        1214
        1223
        1227
        1231
        1235
        1243
        1248
        1256
        1261
        1265
        1270
        1278
        1283
        1288
        1293
        1299
        1307
        1313
        1319
        1327
        1335
        1342
        1350
        1358
        1366
        1375
        1382
        1389
        1397
        1404
        1411
        1418
        1427
        1434
        1443
        1452
        1460
        1469
        1478
        1486
        1494
        1502
        1511
        1519
        1529
        1539
        1549
        1559
        1568
        1577
        1586
        1595
        1603
        1612
        1621
        1630
        1639
        1648
        1657
        1666
        1675
        1684
        1692
        1702
        1711
        1720
        1729
        1739
        1748
        1757
        1765
        1774
        1783
        1793
        1804
        1815
        1826
        1836
        1846
        1856
        1866
        1876
        1886
        1895
        1905
        1915
        1925
        1935
        1945
        1955
        1965
        1975
        1985
        1995
        2005
        2017
        2027
        2039
        2051
        2063
        2074
        2085
        2096
        2107
        2118
        2129
        2140
        2151
        2162
        2173
        2184
        2195
        2206
        2217
        2228
        2239
        2250
        2261
        2272
        2283
        2294
        2305
        2316
        2327
        2338
        2349
        2361
        2373
        2384
        2396
        2408
        2420
        2432
        2444
        2456
        2468
        2480
        2491
        2503
        2514
        2526
        2537
        2547
        2558
        2569
        2580
        2591
        2602
        2613
        2624
        2634
        2645
        2656
        2667
        2678
        2689
        2700
        2711
        2722]



cum_number_gmres_iter_time_exact_res = [30
          60
          90
         120
         150
         180
         210
         240
         270
         300
        1578
        1836
        2040
        2244
        2460
        2676
        2874
        3051
        3231
        3441
        3639
        3798
        3969
        4167
        4329
        4512
        4680
        4827
        4998
        5163
        5340
        5514
        5685
        5856
        6024
        6195
        6342
        6507
        6687
        6858
        7026
        7200
        7365
        7515
        7629
        7785
        7941
        8103
        8292
        8472
        8664
        8853
        9054
        9291
        9537
        9798
       10086
       10368
       10638
       10887
       11121
       11346
       11574
       11790
       12003
       12204
       12411
       12609
       12813
       13008
       13197
       13392
       13578
       13767
       13929
       14106
       14283
       14451
       14607
       14751
       14895
       15060
       15219
       15399
       15570
       15735
       15876
       16017
       16161
       16305
       16446
       16608
       16758
       16890
       17031
       17181
       17319
       17454
       17583
       17724
       17853
       17985
       18120
       18252
       18393
       18525
       18636
       18762
       18882
       19014
       19134
       19263
       19380
       19506
       19635
       19767
       19893
       20019
       20136
       20262
       20373
       20481
       20598
       20709
       20829
       20931
       21039
       21147
       21255
       21303
       21393
       21498
       21603
       21651
       21759
       21806
       21905
       21998
       22106
       22211
       22256
       22352
       22451
       22499
       22547
       22595
       22700
       22748
       22838
       22886
       22933
       22981
       23071
       23119
       23167
       23215
       23264
       23354
       23403
       23452
       23542
       23638
       23687
       23771
       23821
       23871
       23961
       24010
       24059
       24137
       24186
       24235
       24284
       24334
       24383
       24433
       24483
       24567
       24617
       24667
       24748
       24798
       24848
       24938
       24988
       25039
       25090
       25141
       25192
       25242
       25292
       25379
       25429
       25507
       25557
       25607
       25657
       25707
       25757
       25807
       25857
       25907
       25956
       26005
       26055
       26104
       26153
       26202
       26252
       26301
       26350
       26425
       26474
       26523
       26572
       26622
       26672
       26722
       26771
       26820
       26869
       26918
       26967
       27016
       27065
       27114
       27163
       27212
       27261
       27310
       27359
       27408
       27457
       27506
       27555
       27604
       27654
       27703
       27753
       27803
       27853
       27902
       27951
       28000
       28049
       28098
       28147
       28196
       28245
       28294
       28343
       28392
       28441
       28490
       28539
       28588
       28637
       28686
       28735
       28784
       28833
       28882
       28931
       28980
       29029
       29078
       29127
       29176
       29225
       29274
       29323
       29372
       29421
       29470
       29519
       29568
       29617
       29666
       29714
       29763
       29811
       29860
       29908
       29955
       30003
       30051
       30099
       30147
       30195
       30243
       30291
       30338
       30386
       30434
       30482
       30530
       30578
       30626
       30674
       30722]




%%%%%%%%%%%%%%%%%%
%% file containing a matrix giving the number of gmres iterations per newton FB iterations per time step

'simu_FB_exact_res_number_gmres_iter_newton_iter_time' and 'simu_FB_number_gmres_newton_time'


%% Prepare plot for number of gmres iter per newton iter per time step for exact newton FB
[rowIdx, colIdx] = find(simu_FB_exact_res_number_gmres_iter_newton_iter_time);
extract_term = accumarray(rowIdx,colIdx,[],@max); %% gives the number of Newton iterations per time step
time_step = Dt./ extract_term;
rep_time_exact_newton = repelem(time_step, extract_term);

tp_number_gmres_iter_number_iter_time_exact_res = simu_FB_exact_res_number_gmres_iter_newton_iter_time';

tp_number_gmres_iter_number_iter_time_exact_res = reshape(tp_number_gmres_iter_number_iter_time_exact_res, Tmax*size(simu_FB_exact_res_number_gmres_iter_newton_iter_time, 2),1);%% a matrix 

temp_non_zero = find(tp_number_gmres_iter_number_iter_time_exact_res);

res_exact_resolution = tp_number_gmres_iter_number_iter_time_exact_res(temp_non_zero);


%% Prepare plot for number of gmres iter per newton iter per time step for adapt inexact newton FB
[rowIdx, colIdx] = find(simu_FB_number_gmres_newton_time);
extract_term = accumarray(rowIdx,colIdx,[],@max); %% gives the number of Newton iterations per time step
time_step = Dt./ extract_term;
rep_time_adapt_inexact_newton = repelem(time_step, extract_term);

tp_number_gmres_iter_number_iter_time_adapt_inexact_res = simu_FB_number_gmres_newton_time';

tp_number_gmres_iter_number_iter_time_adapt_inexact_res = reshape(tp_number_gmres_iter_number_iter_time_adapt_inexact_res, Tmax*size(simu_FB_number_gmres_newton_time, 2),1);%% a matrix 

temp_non_zero = find(tp_number_gmres_iter_number_iter_time_adapt_inexact_res);

res_adapt_inexact_resolution = tp_number_gmres_iter_number_iter_time_adapt_inexact_res(temp_non_zero);




%% Plot number gmres iter per newton iter per time
figure;
plot(cumsum(rep_time_exact_newton), res_exact_resolution,...
'o -', 'linewidth', 2, 'Color', midnight_blue, 'MarkerFaceColor', midnight_blue);
hold on;
plot(cumsum(rep_time_adapt_inexact_newton), res_adapt_inexact_resolution,...
'^ -', 'linewidth', 2, 'Color', OrangeRed2, 'MarkerFaceColor', OrangeRed2);
xlabel('Time/Newton-Fischer-Burmeister step', 'FontSize', 15);
ylabel('Number of GMRES iterations', 'FontSize', 15);
xt = get(gca, 'XTick');
set(gca, 'FontSize', 13);
h_legend = legend('exact Newton-Fischer-Burmeister', 'adaptive inexact Newton-Fischer-Burmeister');
set(h_legend, 'FontSize', 13);



